webpackJsonp([9],{jFMF:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("c/Tr"),n=i.n(s),o=i("Dd8w"),a=i.n(o),l=i("nv77"),r=i("NYxO"),c={name:"role",data:function(){return{listLoading:!0,listQuery:{name:void 0},roleList:["admin","normal"],rules:{name:[{required:!0,trigger:"blur",validator:function(e,t,i){void 0===t||t.length<0?i(new Error("角色名不能为空")):i()}}],roleKey:[{required:!0,trigger:"blur",validator:function(e,t,i){void 0===t||t.length<0?i(new Error("角色Key不能为空")):i()}}]},textMap:{create:"新建角色",modify:"修改角色",permission:"分配权限"},dialogStatus:"",dialogFormVisible:!1,permissionFormVisible:!1,temp:{id:void 0,username:void 0,password:void 0},tableKey:0,list:null,permissions:[],hasPermissions:void 0,defaultProps:{children:"children",label:"name"}}},created:function(){this.fetchData()},computed:a()({},Object(r.b)(["menus"])),methods:{fetchData:function(){var e=this;this.listLoading=!0,Object(l.j)(this.listQuery).then(function(t){e.list=t.dataList,e.listLoading=!1})},resetTemp:function(){this.temp={id:void 0,username:void 0,password:void 0}},saveAddRole:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.deleted=0,Object(l.a)(e.temp).then(function(t){e.$message({message:"添加角色成功",type:"success"}),e.dialogFormVisible=!1,e.fetchData()}))})},addRole:function(){this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0},modifyRole:function(e){this.temp=e,this.dialogStatus="modify",this.dialogFormVisible=!0},saveModifyRole:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.deleted=0,Object(l.n)(e.temp).then(function(t){e.$message({message:"修改成功",type:"success"}),e.dialogFormVisible=!1,e.fetchData()}))})},grantPermission:function(e){var t=this;this.permissionFormVisible=!0,this.dialogStatus="permission",this.temp=e,this.hasPermissions=[],Object(l.g)().then(function(e){t.permissions=e.dataList}),Object(l.i)(e.id).then(function(e){console.log(e.data.menus);var i=[];n()(e.data.menus).forEach(function(e){i.push(e.id)}),t.hasPermissions=i,t.$refs.tree.setCheckedNodes(i)}),this.defaultProps={children:"children",label:"name"}},savePermission:function(){var e=this,t=[];n()(this.$refs.tree.getCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),n()(this.$refs.tree.getHalfCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),this.temp.menus=t,Object(l.c)(this.temp).then(function(t){e.$message({message:"分配权限成功",type:"success"}),e.permissionFormVisible=!1})},deleteRole:function(e){var t=this;this.$confirm("删除该角色影响对应用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){Object(l.f)({id:e.id}).then(function(e){t.$message({message:"删除角色成功",type:"success"}),t.fetchData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"operation-container"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.add"),expression:"menus.indexOf('account.role.add')!==-1"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){e.addRole()}}},[e._v("添加")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"加载中",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",width:"65",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"角色名",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"角色key",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.roleKey))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"描述",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.description))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"创建时间",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.modify"),expression:"menus.indexOf('account.role.modify')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(i){e.modifyRole(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.grant"),expression:"menus.indexOf('account.role.grant')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(i){e.grantPermission(t.row)}}},[e._v("角色权限")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.role.delete"),expression:"menus.indexOf('account.role.delete')!==-1"}],attrs:{type:"danger",size:"mini"},on:{click:function(i){e.deleteRole(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[i("el-form-item",{attrs:{label:"角色名",prop:"name"}},[i("el-input",{model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色key",prop:"roleKey"}},[i("el-input",{model:{value:e.temp.roleKey,callback:function(t){e.$set(e.temp,"roleKey",t)},expression:"temp.roleKey"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色描述"}},[i("el-input",{model:{value:e.temp.description,callback:function(t){e.$set(e.temp,"description",t)},expression:"temp.description"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveAddRole()}}},[e._v("添加")]):i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveModifyRole()}}},[e._v("更新")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.permissionFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.permissionFormVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"250px","margin-left":"50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[i("el-tree",{ref:"tree",attrs:{data:e.permissions,"show-checkbox":"","node-key":"id","default-expanded-keys":[11e4,12e4,13e4],"default-checked-keys":e.hasPermissions,"highlight-current":"",props:e.defaultProps}})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.permissionFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.savePermission()}}},[e._v("分配")])],1)],1)],1)},staticRenderFns:[]},u=i("VU/8")(c,d,!1,null,null,null);t.default=u.exports}});
//# sourceMappingURL=9.01dddd51852ec7345a69.js.map