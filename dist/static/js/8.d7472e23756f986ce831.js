webpackJsonp([8],{"9uZd":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("c/Tr"),a=s.n(i),r=s("Dd8w"),n=s.n(r),o=s("nv77"),l=s("E4LH"),c=s("NYxO"),u={name:"user",data:function(){var e=this;return{listLoading:!0,listQuery:{name:void 0},typeList:[{name:"管理员",type:2},{name:"普通用户",type:3}],rules:{userName:[{required:!0,trigger:"blur",validator:function(e,t,s){Object(l.b)(t)?s():s(new Error("用户名过短"))}}],password:[{required:!0,trigger:"blur",validator:function(e,t,s){void 0===t||t.length<5?s(new Error("密码不能小于5位数")):Object(l.a)(t)?s():s(new Error("密码过于简单"))}}],newpasswd:[{required:!0,trigger:"blur",validator:function(t,s,i){s!==e.temp.password?i(new Error("二次密码不相同")):i()}}]},textMap:{create:"新建用户",modify:"修改信息",resetPassword:"重置密码",permission:"分配权限"},dialogStatus:"",createFormVisible:!1,modifyFormVisible:!1,resetPasswordFormVisible:!1,permissionFormVisible:!1,temp:{id:void 0,userName:void 0,passwd:void 0,email:void 0,newpasswd:void 0,role:void 0},tableKey:0,list:null,permissions:void 0,hasPermissions:void 0,defaultProps:void 0,currentPage:1,pageSize:20,totalPage:0,roles:void 0,defaultExpanded:[11e4,12e4,13e4]}},filters:{typeFilter:function(e){return{1:"超级管理员",2:"管理员",3:"普通用户"}[e]}},created:function(){this.fetchData()},computed:n()({},Object(c.b)(["menus"])),methods:{fetchData:function(){var e=this;this.listLoading=!0,Object(o.k)(this.listQuery,this.currentPage,this.pageSize).then(function(t){e.list=t.dataList,e.currentPage=t.currentPage,e.pageSize=t.pageSize,e.totalPage=t.totalPage,e.listLoading=!1}),Object(o.j)().then(function(t){e.roles=t.dataList})},resetTemp:function(){this.temp={id:void 0,userName:void 0,passwd:void 0}},createUser:function(){this.resetTemp(),this.dialogStatus="create",this.createFormVisible=!0},saveCreate:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.type=3,Object(o.b)(e.temp).then(function(t){e.$message({message:"添加成功",type:"success"}),e.createFormVisible=!1,e.fetchData()}))})},modifyUser:function(e){this.temp={id:e.id,userName:e.userName,email:e.email,phone:e.phone,type:e.type,role:void 0},this.dialogStatus="modify",this.modifyFormVisible=!0},saveModify:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){if(e.temp.role){var s=[];e.temp.role.forEach(function(e,t){s.push({id:e})}),e.temp.roles=s}Object(o.p)(e.temp).then(function(t){e.$message({message:"修改成功",type:"success"}),e.createFormVisible=!1})}})},lockUser:function(e){var t=this;e.state=1===e.state?0:1,Object(o.l)({id:e.id,state:e.state}).then(function(s){t.$message({message:0===e.state?"解锁成功":"锁定成功",type:"success"})})},deleteUser:function(e){var t=this;this.$confirm("确定删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){Object(o.e)({id:e.id}).then(function(e){t.$message({message:"删除成功",type:"success"}),t.fetchData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},resetPassword:function(e){this.temp={id:e.id,password:void 0,newpasswd:void 0},this.dialogStatus="resetPassword",this.resetPasswordFormVisible=!0},saveResetPassword:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&Object(o.q)(e.temp).then(function(t){e.$message({message:"重置成功",type:"success"}),e.resetPasswordFormVisible=!1})})},grantPermission:function(e){var t=this;this.permissionFormVisible=!0,this.dialogStatus="permission",this.temp=e,this.permissions=[],this.hasPermissions=[],Object(o.g)().then(function(e){t.permissions=e.dataList}),Object(o.h)({id:e.id}).then(function(e){var s=[];a()(e.dataList).forEach(function(e){s.push(e.id)}),t.hasPermissions=s}),console.log(this.hasPermissions),this.defaultProps={children:"children",label:"name"}},savePermission:function(){var e=this,t=[];a()(this.$refs.tree.getCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),a()(this.$refs.tree.getHalfCheckedKeys()).forEach(function(e){t.push({id:e,hasPermission:!0})}),this.temp.menus=t,Object(o.d)(this.temp).then(function(t){e.$message({message:"分配权限成功",type:"success"})})},search:function(){var e=this;Object(o.k)(this.listQuery,this.currentPage,this.pageSize).then(function(t){e.list=t.dataList,e.currentPage=t.currentPage,e.pageSize=t.pageSize,e.listLoading=!1,e.$message({message:"查询成功",type:"success"})})},handleSizeChange:function(e){this.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.currentPage=e,this.fetchData()}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"operation-container"},[s("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请输入用户名"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.search(t)}},model:{value:e.listQuery.userName,callback:function(t){e.$set(e.listQuery,"userName",t)},expression:"listQuery.userName"}}),e._v(" "),s("el-select",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"选择用户类型"},model:{value:e.listQuery.type,callback:function(t){e.$set(e.listQuery,"type",t)},expression:"listQuery.type"}},e._l(e.typeList,function(e){return s("el-option",{key:e.name,attrs:{label:e.name,value:e.type}})})),e._v(" "),s("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.add"),expression:"menus.indexOf('account.user.add')!==-1"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.createUser}},[e._v("添加")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"加载中",border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{align:"center",width:"65",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"用户名",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.userName))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"类型",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:e._f("typeFilter")(t.row.type)}},[e._v(e._s(e._f("typeFilter")(t.row.type)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"角色",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return s("el-tag",{key:t.name,attrs:{type:"success"}},[e._v(" "+e._s(t.name))])})}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"手机号",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.phone))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"邮箱",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.email))])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"创建时间",width:"200px",sortable:"",prop:"date"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-time"}),e._v(" "),s("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.modify"),expression:"menus.indexOf('account.user.modify')!==-1"}],attrs:{type:"primary",size:"small"},on:{click:function(s){e.modifyUser(t.row)}}},[e._v("编辑")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.resetPwd"),expression:"menus.indexOf('account.user.resetPwd')!==-1"}],attrs:{type:"success",size:"small"},on:{click:function(s){e.resetPassword(t.row)}}},[e._v("重置密码")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.grant"),expression:"menus.indexOf('account.user.grant')!==-1"}],attrs:{type:"danger",size:"small"},on:{click:function(s){e.grantPermission(t.row)}}},[e._v("用户权限")]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.lock"),expression:"menus.indexOf('account.user.lock')!==-1"}],attrs:{type:"publish",size:"small"},on:{click:function(s){e.lockUser(t.row)}}},[e._v(e._s(1==t.row.state?"解锁":"锁定"))]),e._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:-1!==e.menus.indexOf("account.user.delete"),expression:"menus.indexOf('account.user.delete')!==-1"}],attrs:{type:"danger",size:"small"},on:{click:function(s){e.deleteUser(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.createFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.createFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName",t)},expression:"temp.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"用户密码",prop:"password"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password",t)},expression:"temp.password"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.createFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveCreate()}}},[e._v("添加")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.modifyFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.modifyFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName",t)},expression:"temp.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.phone,callback:function(t){e.$set(e.temp,"phone",t)},expression:"temp.phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.email,callback:function(t){e.$set(e.temp,"email",t)},expression:"temp.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"用户类型"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"选择用户类型"},model:{value:e.listQuery.type,callback:function(t){e.$set(e.listQuery,"type",t)},expression:"listQuery.type"}},e._l(e.typeList,function(e){return s("el-option",{key:e.name,attrs:{label:e.name,value:e.type}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"用户角色"}},[s("el-select",{attrs:{multiple:"",placeholder:"选择用户角色"},model:{value:e.temp.role,callback:function(t){e.$set(e.temp,"role",t)},expression:"temp.role"}},e._l(e.roles,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.modifyFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveModify()}}},[e._v("更新")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.resetPasswordFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.resetPasswordFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"8%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"新设密码",prop:"password"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password",t)},expression:"temp.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"重复密码",prop:"newpasswd"}},[s("el-input",{attrs:{type:"text"},model:{value:e.temp.newpasswd,callback:function(t){e.$set(e.temp,"newpasswd",t)},expression:"temp.newpasswd"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.resetPasswordFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveResetPassword()}}},[e._v("重置")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.permissionFormVisible,center:"",width:"25%"},on:{"update:visible":function(t){e.permissionFormVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%","margin-left":"5%"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"90px"}},[s("el-tree",{ref:"tree",attrs:{data:e.permissions,"show-checkbox":"","node-key":"id","default-expanded-keys":e.defaultExpanded,"default-checked-keys":e.hasPermissions,"highlight-current":"",props:e.defaultProps}})],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.permissionFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.savePermission()}}},[e._v("分配")])],1)],1),e._v(" "),[s("div",{staticClass:"block page-container"},[s("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":1,layout:"total, sizes, prev, pager, next, jumper",total:20},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]],2)},staticRenderFns:[]},p=s("VU/8")(u,d,!1,null,null,null);t.default=p.exports}});
//# sourceMappingURL=8.d7472e23756f986ce831.js.map